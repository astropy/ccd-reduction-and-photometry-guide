
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>6.1. Identifying hot pixels &#8212; CCD Data Reduction Guide</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.2. Creating an image mask" href="08-02-Creating-a-mask.html" />
    <link rel="prev" title="6. Image masking" href="08-00-Image-masking.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CCD Data Reduction Guide</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00-00-Preface.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="01-00-Understanding-an-astronomical-CCD-image.html">
   1. Astronomical Images
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="01-01-astronomical-CCD-image-components.html">
     1.1. Components of astronomical images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-03-Construction-of-an-artificial-but-realistic-image.html">
     1.2. An artificial, but realistic, image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-04-Nonuniform-sensitivity.html">
     1.3. Non-uniform sensitivity in astronomical detectors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-05-Calibration-overview.html">
     1.4. Calibration overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-06-Image-combination.html">
     1.5. Image combination
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-08-Overscan.html">
     1.6. Overscan
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-09-Calibration-choices-you-need-to-make.html">
     1.7. Calibration choices to make
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-11-reading-images.html">
     1.8. Reading images
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="02-00-Handling-overscan-trimming-and-bias-subtraction.html">
   2. Overscan and bias images
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="02-01-overscan-trimming-and-bias-subtraction-background.html">
     2.1. About bias and overscan
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02-02-Calibrating-bias-images.html">
     2.2. Calibrating bias images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02-04-Combine-bias-images-to-make-master.html">
     2.3. Combine bias images to make master bias
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="03-00-Dark-current-and-hot-pixels.html">
   3. Dark current and dark frames
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="03-01-Dark-current-The-ideal-case.html">
     3.1. Dark current: the ideal case
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-02-Real-dark-current-noise-and-other-artifacts.html">
     3.2. Real dark current: noise and other artifacts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-04-Handling-overscan-and-bias-for-dark-frames.html">
     3.3. Handling overscan and bias for dark frames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-05-Calibrate-dark-images.html">
     3.4. Calibrate dark images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-06-Combine-darks-for-use-in-later-calibration-steps.html">
     3.5. Combine calibrated dark images for use in later reduction steps
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="05-00-Flat-corrections.html">
   4. Flat fielding
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="05-01-about-flat-corrections.html">
     4.1. Calibrating flat frames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05-03-Calibrating-the-flats.html">
     4.2. Calibrating flat frames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05-04-Combining-flats.html">
     4.3. Combining flat frames
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="06-00-Reducing-science-images.html">
   5. Calibrating science images
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06-03-science-images-calibration-examples.html">
     5.1. Two calibration examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="08-00-Image-masking.html">
   6. Finding and dealing with bad pixels
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     6.1. Identifying hot pixels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-02-Creating-a-mask.html">
     6.2. Identifying bad pixels with ccdmask
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-03-Cosmic-ray-removal.html">
     6.3. Removing cosmic rays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-05-incorporating-masks-into-calibrated-science-images.html">
     6.4. Incorporating masks in science images
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            <h2>Book edition: dev</h2>
<strong>Previous editions</strong></br>
<a href="../../../v/2.0.1/index.html">2.0.1</a></br>
<a href="../../../v/2.0.0/index.html">2.0.0</a></br>
<a href="../../../v/dev/index.html">dev (latest)</a></br>
Powered by <a href="https://jupyterbook.org">Jupyter Book</a> and
<a href="https://astropy.org">Astropy</a>

            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/astropy/ccd-reduction-and-photometry-guide/main?urlpath=lab/tree/notebooks/notebooks/08-01-Identifying-hot-pixels.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/issues/new?title=Issue%20on%20page%20%2Fnotebooks/08-01-Identifying-hot-pixels.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/edit/main/notebooks/notebooks/08-01-Identifying-hot-pixels.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/08-01-Identifying-hot-pixels.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-pixels-are-too-hot">
   6.1.1. Some pixels are too hot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example">
   6.1.2. Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rule-of-thumb">
   6.1.3. Rule of thumb
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-the-mask">
   6.1.4. Saving the mask
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Identifying hot pixels</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-pixels-are-too-hot">
   6.1.1. Some pixels are too hot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example">
   6.1.2. Example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rule-of-thumb">
   6.1.3. Rule of thumb
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-the-mask">
   6.1.4. Saving the mask
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="identifying-hot-pixels">
<h1><span class="section-number">6.1. </span>Identifying hot pixels<a class="headerlink" href="#identifying-hot-pixels" title="Permalink to this headline">#</a></h1>
<section id="some-pixels-are-too-hot">
<h2><span class="section-number">6.1.1. </span>Some pixels are too hot<a class="headerlink" href="#some-pixels-are-too-hot" title="Permalink to this headline">#</a></h2>
<p>Recall from the <a class="reference internal" href="03-02-Real-dark-current-noise-and-other-artifacts.html"><span class="doc std std-doc">notebook about dark current</span></a> that even  a
cryogenically-cooled camera with low dark current has some pixels with much
higher dark current. In the <a class="reference internal" href="03-01-Dark-current-The-ideal-case.html"><span class="doc std std-doc">discussion of “ideal” dark current</span></a> we noted that the
counts in a dark image should be proportional to the exposure time.</p>
<p>For some hot pixels that is not the case, unfortunately, which means that those
pixels cannot conveniently be corrected by subtracting a combined dark. Those pixels
can be identified by taking darks with two different (but long) exposure times
and comparing the dark current derived from each of the images. The dark
current, measured in electron/sec, should be the same in both images if the dark
current is really constant.</p>
<p>Fortunately, the pixels whose response is not proportional to exposure time are
usually also pixels with high dark current. It is possible to identify
those pixels and create a mask to exclude them when processing images. If this
weren’t the case it might be necessary to take some dark frames with much longer
exposure times than otherwise needed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">hist</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">CCDData</span>

<span class="kn">import</span> <span class="nn">ccdproc</span> <span class="k">as</span> <span class="nn">ccdp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use custom style for larger fonts and figures</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;guide.mplstyle&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="example">
<h2><span class="section-number">6.1.2. </span>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h2>
<p>There are two combined dark images available for the thermoelectrically-cooled
Andor Aspen CG16M discussed as “Example 2” in previous notebooks. One is an
average of ten 90 second exposures taken during observations of the transiting
exoplanet KELT-16 b. The other is an average of twenty 1,000 second exposures
taken during commission of the camera. Typically you will not have a single dark
of with an exposure time that long, let alone several of them.</p>
<p>We begin by reading each combined dark and calculating the dark current from the
counts in the image using</p>
<div class="math notranslate nohighlight">
\[
\text{dark current} = \text{gain} \times \text{dark counts}~/ \text{ exposure time }.
\]</div>
<p>The gain for this camera is 1.5 <span class="math notranslate nohighlight">\(e^-\)</span>/adu. The 1,000 second exposure also needs
to be trimmed to remove the overscan region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ex2_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;example2-reduced&#39;</span><span class="p">)</span>

<span class="n">dark_90</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ex2_path</span> <span class="o">/</span> <span class="s1">&#39;combined_dark_90.000.fit&#39;</span><span class="p">)</span>
<span class="n">dark_1000</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;combined_dark_exposure_1000.0.fit.bz2&#39;</span><span class="p">)</span>
<span class="n">dark_1000</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">dark_1000</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4096</span><span class="p">])</span>

<span class="n">dark_90</span> <span class="o">=</span> <span class="n">dark_90</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">electron</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">adu</span><span class="p">)</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">90</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
<span class="n">dark_1000</span> <span class="o">=</span> <span class="n">dark_1000</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">electron</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">adu</span><span class="p">)</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 58269.955093 from DATE-OBS&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
</div>
</div>
<p>The histogram below shows the distribution of dark current values in each image.
There are some differences we should <em>expect</em> to see between the two images.</p>
<p>Small values of dark current are much more accurately measured in the long
exposure. The exposure time in that image was chosen to be as short as possible
while still measuring the nominal dark current of 0.01 <span class="math notranslate nohighlight">\(e^-\)</span>/sec from the
manufacturer given that the camera’s read noise is 10<span class="math notranslate nohighlight">\(e^-\)</span>.</p>
<p>For the average of ten 90 second exposures, that read noise will be reduced to
10<span class="math notranslate nohighlight">\(e^-/\sqrt{10} \approx\)</span>3.2<span class="math notranslate nohighlight">\(e^-\)</span>. After dividng by exposure time, this is
equivalent to a “dark current” of 0.035<span class="math notranslate nohighlight">\(e^-\)</span>/sec. Roughly twice that is the
smallest dark current that can be accurately measured in the 90 second dark.</p>
<p>For large values of dark current, the shorter exposure is more accurate. Some of
the pixels saturate (i.e., reach the maximum value the chip can read out, roughly
65,000) in under 90 sec and more of them saturate at some time between 90
seconds and 1,000 seconds. None of those pixels are accurately measured by the
long 1,000 second exposure time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">hist</span><span class="p">(</span><span class="n">dark_90</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;90 sec dark&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">hist</span><span class="p">(</span><span class="n">dark_1000</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1000 sec dark&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;dark current, $e^-$/sec&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08-01-Identifying-hot-pixels_8_0.png" src="../_images/08-01-Identifying-hot-pixels_8_0.png" />
</div>
</div>
<p>Overall, there appear to be more hot pixels in the 90 sec exposure than in the
1,000 sec exposure. For dark current under 0.1 <span class="math notranslate nohighlight">\(e^-\)</span>/sec, that is certainly
affected by the read noise in the 90 sec exposure.</p>
<p>To get a better idea of how consistent the dark current measurements are, we
construct a scatter plot with the measured dark current from each image for
those pixels in which the dark current is larger than 1<span class="math notranslate nohighlight">\(e^-\)</span>/sec as measured in
the longer exposure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hot_pixels</span> <span class="o">=</span> <span class="p">(</span><span class="n">dark_1000</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dark_90</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">hot_pixels</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">dark_1000</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">hot_pixels</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;dark current ($e^-$/sec), 90 sec exposure time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;dark current ($e^-$/sec), 1000 sec exposure time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ideal relationship&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08-01-Identifying-hot-pixels_11_0.png" src="../_images/08-01-Identifying-hot-pixels_11_0.png" />
</div>
</div>
<p>The upper limit on dark current that can be measured with the long exposure time
can be clearly seen in the plot above; there is a ceiling at roughly 95<span class="math notranslate nohighlight">\(e^-\)</span>/sec
above which the dark current in the long exposure does not go.</p>
<p>It looks like the dark current as measured in each frame is equal for lower
values of the dark current, so we replot to get a better look at that region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dark_90</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">hot_pixels</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">dark_1000</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">hot_pixels</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;dark current ($e^-$/sec), 90 sec exposure time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;dark current ($e^-$/sec), 1000 sec exposure time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ideal relationship&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08-01-Identifying-hot-pixels_13_0.png" src="../_images/08-01-Identifying-hot-pixels_13_0.png" />
</div>
</div>
<p>Here it looks like the measured dark currents are consistent until around
4<span class="math notranslate nohighlight">\(e^-\)</span>/sec. Beyond that the dark current is consistently larger in the short
exposure than in the long exposure.</p>
<p>Because of this, we will mark all pixels with dark current larger than
4<span class="math notranslate nohighlight">\(e^-\)</span>/sec as bad. Below that the dark current seems to be measured consistently
in both exposures so it ought to be possible to remove the dark current by
subtracting a combined dark frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bad_hot_pixels</span> <span class="o">=</span> <span class="p">(</span><span class="n">dark_90</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">bad_hot_pixels</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4302
</pre></div>
</div>
</div>
</div>
<p>This amounts to 4302 pixels, or 0.026% of the pixels in the camera.</p>
</section>
<section id="rule-of-thumb">
<h2><span class="section-number">6.1.3. </span>Rule of thumb<a class="headerlink" href="#rule-of-thumb" title="Permalink to this headline">#</a></h2>
<p>The example in this notebook is a little unusual in that a very long exposure
dark is available. In deciding what pixels to mask because of high dark current
you have a few options:</p>
<ul class="simple">
<li><p>Use whatever exposure time range you have. The images in “Example 1” from the
previous notebook have darks with exposure times 7, 70, and 300 seconds. The 7
second dark is primarily measuring read noise, so is not likely to be useful.
The current in the 70 second and 300 second darks could be compared, though, as
it was in this case.</p></li>
<li><p>If that is not an option, as was the case with the data in “Example 2,” then you
may need to pick a cutoff. Keep in mind that the typical camera has very, very
low dark current, so a limit like 1<span class="math notranslate nohighlight">\(e^-\)</span>/sec is not unreasonable.</p></li>
<li><p>Ask other users of the instrument what they do. Large observatories may
provide a mask image of bad pixels for the camera you are using.</p></li>
<li><p>Do not do any masking. This is a more reasonable option than you might think.
Most pixels are measuring light from the nighttime sky. If one of these hot
pixels happens to be in that background, and outlying pixels are rejected by a
method like sigma clipping, then these hot pixels will be excluded from your
analysis. If the object of interest happens to fall on one the bad pixels you
may well notice it. In time series photometry this sometimes manifests as a
single data point that is well outside the trend in the rest of the data.</p></li>
</ul>
</section>
<section id="saving-the-mask">
<h2><span class="section-number">6.1.4. </span>Saving the mask<a class="headerlink" href="#saving-the-mask" title="Permalink to this headline">#</a></h2>
<p>The mask can be saved as in a FITS file. We will see in the notebook <a class="reference internal" href="08-05-incorporating-masks-into-calibrated-science-images.html"><span class="doc std std-doc">incorporating masks in science images</span></a> how
to include this mask. Casting the mask as an unsigned integer is necessary
because FITS cannot store boolean data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask_as_ccd</span> <span class="o">=</span> <span class="n">CCDData</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">bad_hot_pixels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span><span class="p">)</span>
<span class="n">mask_as_ccd</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;imagetyp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dark mask&#39;</span>
<span class="n">mask_as_ccd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ex2_path</span> <span class="o">/</span> <span class="s1">&#39;mask_from_dark_current.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="08-00-Image-masking.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">6. </span>Image masking</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="08-02-Creating-a-mask.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6.2. </span>Creating an image mask</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Matthew Craig<br/>
  
      &copy; Copyright 2020-2023.<br/>
    <div class="extra_footer">
      <p xmlns:cc="http://creativecommons.org/ns#" >This work is licensed under
<a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY 4.0
<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1">
<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a></p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>